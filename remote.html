<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <title>Blitz ‚ö°</title>
    <style>
        /* --- Base Styles --- */
        :root {
            --bg-dark: #1a1a2e;
            --bg-light: #16213e;
            --accent-primary: #0f3460;
            --accent-secondary: #e94560;
            --text-light: #e0e0e0;
            --text-dark: #a0a0a0;
            --status-connected: #2ecc71;
            --status-disconnected: #e74c3c;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: grid;
            place-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 450px;
            margin: 20px;
            padding: 25px;
            background-color: var(--bg-light);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 25px;
        }

        /* --- Connection Area --- */
        .connection-area {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        #ipAddress {
            flex-grow: 1;
            padding: 12px;
            font-size: 1em;
            background-color: var(--bg-dark);
            border: 1px solid var(--accent-primary);
            color: var(--text-light);
            border-radius: 8px;
        }

        #connectButton {
            padding: 12px 15px;
            font-size: 1em;
            font-weight: 600;
            background-color: var(--accent-primary);
            color: var(--text-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #connectButton:hover {
            background-color: #1a5fb4;
            /* A lighter blue */
        }

        #connectButton:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #status {
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .connected {
            color: var(--status-connected);
        }

        .disconnected {
            color: var(--status-disconnected);
        }

        /* --- Remote Grid --- */
        #remote-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* 2 columns */
            gap: 15px;
            margin-bottom: 25px;
        }

        .remote-btn {
            padding: 20px;
            font-size: 1.1em;
            font-weight: 600;
            background-color: var(--accent-primary);
            color: var(--text-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .remote-btn:hover {
            background-color: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.2);
        }

        .remote-btn:active {
            transform: scale(0.98);
        }

        /* --- Output Area --- */
        h3 {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 10px;
        }

        #output {
            background-color: #111;
            border: 1px solid var(--accent-primary);
            padding: 15px;
            border-radius: 8px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: var(--font-mono);
            font-size: 0.9em;
            color: #f0f0f0;
            transition: opacity 0.2s ease;
        }

        /* --- Music Player --- */
        .player-info {
            background-color: var(--accent-primary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--accent-secondary);
        }

        .player-info h3 {
            color: var(--text-light);
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .player-content {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .album-art {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: none;
            transition: opacity 0.5s ease-in-out, transform 0.3s ease;
            opacity: 0;
        }

        .album-art.visible {
            display: block;
            opacity: 1;
        }

        .album-art.fade-out {
            opacity: 0;
        }

        .album-art:hover {
            transform: scale(1.05);
        }

        .player-info .track {
            color: var(--text-light);
            font-size: 1.1em;
            font-weight: 600;
            font-family: var(--font-main);
            flex: 1;
            transition: opacity 0.3s ease-in-out;
            min-height: 20px;
        }

        .track.hidden {
            display: none;
        }

        /* --- Player Controls --- */
        .player-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            opacity: 1;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .player-controls.hidden {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
            height: 0;
            margin: 0;
            overflow: hidden;
        }

        .control-btn {
            background-color: var(--bg-dark);
            border: 1px solid var(--accent-secondary);
            color: var(--text-light);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background-color: var(--accent-secondary);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.4);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.play-pause {
            width: 55px;
            height: 55px;
            font-size: 1.5em;
            border-width: 2px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Skeleton Loading --- */
        @keyframes shimmer {
            0% {
                background-position: -468px 0;
            }

            100% {
                background-position: 468px 0;
            }
        }

        .skeleton {
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0.05) 0%,
                    rgba(255, 255, 255, 0.15) 50%,
                    rgba(255, 255, 255, 0.05) 100%);
            background-size: 468px 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        .skeleton-artwork {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            display: none;
        }

        .skeleton-artwork.active {
            display: block;
        }

        .skeleton-text {
            height: 20px;
            width: 200px;
            margin: 0 auto;
            display: none;
        }

        .skeleton-text.active {
            display: block;
        }

        .skeleton-text-small {
            height: 16px;
            width: 150px;
            margin: 8px auto 0;
            display: none;
        }

        .skeleton-text-small.active {
            display: block;
        }

        .player-info {
            background-color: var(--accent-primary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--accent-secondary);
            transition: box-shadow 0.3s ease;
        }

        .player-info:hover {
            box-shadow: 0 4px 20px rgba(233, 69, 96, 0.3);
        }

        /* --- Responsive Layout for Tablets and Larger --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 900px;
            }

            .main-content {
                flex-direction: row;
                align-items: flex-start;
            }

            .music-section {
                flex: 0 0 300px;
                position: sticky;
                top: 20px;
            }

            .controls-section {
                flex: 1;
                min-width: 0;
            }

            .player-info {
                margin-bottom: 0;
            }

            .player-content {
                flex-direction: column;
                text-align: center;
            }

            .album-art {
                width: 200px;
                height: 200px;
            }

            .player-info .track {
                font-size: 1em;
            }

            .control-btn {
                width: 50px;
                height: 50px;
            }

            .control-btn.play-pause {
                width: 60px;
                height: 60px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1100px;
            }

            .music-section {
                flex: 0 0 350px;
            }

            .album-art {
                width: 250px;
                height: 250px;
            }

            .player-info .track {
                font-size: 1.1em;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>‚ö° Blitz Remote</h1>

        <div class="connection-area">
            <input type="text" id="ipAddress" placeholder="Enter PC IP (e.g., 192.168.1.10)">
            <button id="connectButton">Connect</button>
        </div>

        <p id="status" class="disconnected">Status: Not Connected</p>

        <div class="main-content">
            <div class="music-section">
                <div class="player-info">
                    <h3>üéµ Now Playing</h3>
                    <div class="player-content">
                        <div class="skeleton skeleton-artwork" id="skeletonArt"></div>
                        <img id="albumArt" class="album-art" alt="Album artwork">
                        <div>
                            <div class="skeleton skeleton-text" id="skeletonText"></div>
                            <div class="skeleton skeleton-text-small" id="skeletonTextSmall"></div>
                            <div class="track" id="playerInfo">Waiting for connection...</div>
                        </div>
                    </div>
                    <div class="player-controls">
                        <button class="control-btn" onclick="sendCommand('player_prev')" title="Previous">‚èÆÔ∏è</button>
                        <button class="control-btn play-pause" onclick="sendCommand('player_toggle')" title="Play/Pause"
                            id="play-pause">‚ñ∂Ô∏è</button>
                        <button class="control-btn" onclick="sendCommand('player_next')" title="Next">‚è≠Ô∏è</button>
                    </div>
                </div>
            </div>

            <div class="controls-section">
                <div id="remote-grid">
                    <button class="remote-btn" onclick="sendCommand('update')">üöÄ System Update</button>
                    <button class="remote-btn" onclick="sendCommand('list_home')">üìÇ List Home</button>
                    <button class="remote-btn" onclick="sendCommand('status')">Git Status</button>
                    <button class="remote-btn" onclick="sendCommand('open_firefox')">üî• Open Firefox</button>
                    <button class="remote-btn" onclick="sendCommand('open_vscode')">üñ•Ô∏è Open VSCode</button>
                    <button class="remote-btn" onclick="sendCommand('open_edge')">üåê Open Edge</button>
                    <button class="remote-btn" onclick="sendCommand('open_postman')">üì¨ Open Postman</button>
                </div>

                <h3>Output Log:</h3>
                <pre id="output"></pre>
            </div>
        </div>

        <script>
            let ws = null;
            const statusEl = document.getElementById("status");
            const outputEl = document.getElementById("output");
            const ipInput = document.getElementById("ipAddress");
            const connectBtn = document.getElementById("connectButton");
            const playPauseBtn = document.getElementById("play-pause");

            function updatePlayPauseButton(isPlaying) {
                if (isPlaying) {
                    playPauseBtn.textContent = '‚è∏Ô∏è'; // Pause icon
                } else {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è'; // Play icon
                }
            }

            function connect() {
                const ip = ipInput.value.trim();
                const port = 8765;

                if (!ip) {
                    outputEl.textContent = "Please enter an IP address.";
                    return;
                }

                if (ws) {
                    ws.close();
                }

                statusEl.textContent = "Connecting...";
                statusEl.className = "";
                connectBtn.disabled = true;
                ipInput.disabled = true;

                ws = new WebSocket(`ws://${ip}:${port}/ws`);

                ws.onopen = () => {
                    console.log("Connected to WebSocket server");
                    statusEl.textContent = "Status: Connected";
                    statusEl.className = "connected";

                    // Show skeleton while waiting for first update
                    showSkeleton();
                };

                ws.onmessage = (event) => {
                    console.log("Message from server:", event.data);
                    let data = JSON.parse(event.data);

                    if (data.status === 'player') {
                        // Hide skeleton on first data
                        hideSkeleton();

                        // Update the player info display
                        const playerInfoEl = document.getElementById('playerInfo');
                        const albumArtEl = document.getElementById('albumArt');
                        const playerControlsEl = document.querySelector('.player-controls');

                        // Check if music is actually playing (not "No player running" or "playerctl not available")
                        const hasActivePlayer = data.output &&
                            !data.output.includes('No player running') &&
                            !data.output.includes('playerctl not available') &&
                            !data.output.includes('No music');

                        // Show/hide player controls
                        if (hasActivePlayer) {
                            playerControlsEl.classList.remove('hidden');
                        } else {
                            playerControlsEl.classList.add('hidden');
                        }

                        // Check if content actually changed
                        const textChanged = playerInfoEl.textContent !== (data.output || 'No music playing');
                        const artworkChanged = albumArtEl.src !== data.artwork;                    // Update text
                        if (textChanged) {
                            playerInfoEl.textContent = data.output || 'No music playing';
                        }
                        // Update play/pause button
                        updatePlayPauseButton(data["output"].includes("Playing"));

                        // Smooth artwork transition
                        if (data.artwork && data.artwork !== '') {
                            if (artworkChanged) {
                                // Fade out old image
                                albumArtEl.classList.add('fade-out');

                                setTimeout(() => {
                                    albumArtEl.src = data.artwork;
                                    albumArtEl.classList.remove('fade-out');
                                    albumArtEl.classList.add('visible');
                                }, 250);
                            } else if (!albumArtEl.classList.contains('visible')) {
                                // First time showing artwork
                                albumArtEl.src = data.artwork;
                                albumArtEl.classList.add('visible');
                            }
                        } else {
                            // Fade out and hide artwork
                            if (albumArtEl.classList.contains('visible')) {
                                albumArtEl.classList.add('fade-out');
                                setTimeout(() => {
                                    albumArtEl.classList.remove('visible', 'fade-out');
                                }, 500);
                            }
                        }
                    } else if (data.status === 'success') {
                        outputEl.textContent = data.output;
                    } else {
                        outputEl.textContent = `Error: ${data.message}\n\n${data.output || ''}`;
                    }
                };

                ws.onclose = () => {
                    console.log("Disconnected from WebSocket server");
                    statusEl.textContent = "Status: Disconnected";
                    statusEl.className = "disconnected";
                    connectBtn.disabled = false;
                    ipInput.disabled = false;
                    ws = null;
                };

                ws.onerror = (error) => {
                    console.error("WebSocket Error:", error);
                    statusEl.textContent = "Status: Error (Check IP/Firewall)";
                    statusEl.className = "disconnected";
                    connectBtn.disabled = false;
                    ipInput.disabled = false;
                    ws = null;
                };
            }

            function sendCommand(commandName) {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    const message = {
                        command: commandName
                    };
                    ws.send(JSON.stringify(message));
                    outputEl.textContent = `Sent command: ${commandName}...`;
                } else {
                    outputEl.textContent = "Not connected. Please connect first.";
                }
            }

            // Add event listeners
            connectBtn.addEventListener('click', connect);
            ipInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    connect();
                }
            });

            // Skeleton helper functions
            function showSkeleton() {
                document.getElementById('skeletonArt').classList.add('active');
                document.getElementById('skeletonText').classList.add('active');
                document.getElementById('skeletonTextSmall').classList.add('active');
                document.getElementById('playerInfo').classList.add('hidden');
                document.getElementById('albumArt').classList.remove('visible');
            }

            function hideSkeleton() {
                document.getElementById('skeletonArt').classList.remove('active');
                document.getElementById('skeletonText').classList.remove('active');
                document.getElementById('skeletonTextSmall').classList.remove('active');
                document.getElementById('playerInfo').classList.remove('hidden');
            }

        </script>
</body>

</html>